CREATE DATABASE TASK_4
USE TASK_4 

CREATE TABLE DENTIST(
DENTIST_ID VARCHAR(5) PRIMARY KEY,
DENTIST_NAME VARCHAR(10))

CREATE TABLE PATIENT(
PATIENT_NO VARCHAR(4) PRIMARY KEY,
PATIENT_NAME VARCHAR(10))

CREATE TABLE SURGERY(
SURGERY_NO VARCHAR(3) PRIMARY KEY,
SURGERY_NAME VARCHAR(20))

CREATE TABLE RECORDS(
DENTIST_ID VARCHAR(5) FOREIGN KEY REFERENCES DENTIST(DENTIST_ID) ON DELETE CASCADE,
PATIENT_NO VARCHAR(4) FOREIGN KEY REFERENCES PATIENT(PATIENT_NO),
APPOINTMENT_DATE DATE,
APPOINTMENT_TIME DATETIME,
SURGERY_NO VARCHAR(3) FOREIGN KEY REFERENCES SURGERY(SURGERY_NO),
CONSTRAINT COMP_KEY PRIMARY KEY (DENTIST_ID,PATIENT_NO,APPOINTMENT_DATE))

INSERT INTO DENTIST VALUES
('D1011','Roger'),
('D1025','Helen'),
('D1035','Peter')

INSERT INTO PATIENT VALUES
('P100','Smith'),
('P101','Aaron'),
('P105','Bell'),
('P110','Robin')

INSERT INTO SURGERY VALUES
('S1','Pulpotomy'),
('S2','Pulpectomy'),
('S11','Apicoectomy')

INSERT INTO RECORDS VALUES
('D1011','P100','2018-10-02','2018-10-02 10:00:00','S1'),
('D1011','P110','2018-10-03','2018-10-03 11:00:00','S2'),
('D1025','P105','2018-10-05','2018-10-05 10:00:00','S11'),
('D1025','P105','2018-10-10','2018-10-10 10:00:00','S11'),
('D1035','P101','2018-10-15','2018-10-15 10:00:00','S2')

SELECT*FROM DENTIST
SELECT*FROM PATIENT
SELECT*FROM SURGERY
SELECT*FROM RECORDS

SELECT R.DENTIST_ID, DENTIST_NAME,R.PATIENT_NO,PATIENT_NAME,APPOINTMENT_DATE,DATEPART(HH,APPOINTMENT_TIME)as APPOINTMENT_TIME ,R.SURGERY_NO,SURGERY_NAME
FROM RECORDS AS R
JOIN DENTIST AS D ON D.DENTIST_ID = R.DENTIST_ID 
JOIN PATIENT AS P ON P.PATIENT_NO = R.PATIENT_NO
JOIN SURGERY AS S ON S.SURGERY_NO = R.SURGERY_NO

